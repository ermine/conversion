.PHONY: makelib mappings makemap testlib install clean

FILES[] =
   config
   cs
   cs_utf8
   cs_utf16
   cs_ucs2
   cs_ucs4
   cs_utf32
   conversion

config.ml:
   echo $""let decoder_dir = "$(SHAREDIR)/conversion/decoders" "" > $@
   echo $""let encoder_dir = "$(SHAREDIR)/conversion/encoders" "" >> $@
   echo $""let aliases_ini = "$(SHAREDIR)/conversion/aliases.ini" "" >> $@

LIB = conversion

OCAML_OTHER_LIBS = fstream ini_config

.DEFAULT: $(OCamlLibrary $(LIB), $(FILES))

TEST_FILES = test
TEST = test

section
   OCAML_LIBS += conversion
   OCamlProgram($(TEST), $(TEST_FILES))

testlib: test

GEN_MAPPINGS_FILES[] = 
   config
   gen_unimap 
   gen_mappings

GEN_MAPPINGS = gen_mappings

section
   OCAML_LIBS += conversion
   USE_OCAMLFIND = true
   OCAMLPACKS[] = pcre
   gen_mappings.cmx gen_mappings$(EXT_OBJ):
   gen_mappings.cmo:
   gen_mappings.cmi:
   gen_unimap.cmx gen_unimap$(EXT_OBJ):
   gen_unimap.cmo:
   gen_unimap.cmi:
   .DEFAULT: $(OCamlProgram $(GEN_MAPPINGS), $(GEN_MAPPINGS_FILES))

IFILES[] =
   cs
   conversion

ALIBS[] =

LibInstall(makelib, $(LIB), $(IFILES), $(ALIBS))

mappings: $(GEN_MAPPINGS)
   ./$(GEN_MAPPINGS) ./data/tables

install: makelib

.SUBDIRS: tools

clean:
   $(CLEAN) $(GEN_MAPPINGS) config.ml $(TEST)$(EXE)

