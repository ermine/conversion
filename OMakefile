.PHONY: testlib mappings makelib clean

if $(not $(defined LIBDIR))
   include ../../config
   export

FILES[] =
   config
   cs
   cs_utf8
   cs_utf16
   cs_ucs2
   cs_ucs4
   cs_utf32
   conversion

config.ml:
   echo $""let decoder_dir = "$(SHAREDIR)/conversion/decoders" "" > $@
   echo $""let encoder_dir = "$(SHAREDIR)/conversion/encoders" "" >> $@
   echo $""let aliases_ini = "$(SHAREDIR)/conversion/aliases.ini" "" >> $@

LIB = conversion

OCAMLINCLUDES += $(LIBDIR)

section
   OCAML_OTHER_LIBS = fstream ini_config
   .DEFAULT: $(OCamlLibrary $(LIB), $(FILES))

TEST_FILES = test
TEST = test

section
   OCAML_LIBS += conversion
   OCamlProgram($(TEST), $(TEST_FILES))

testlib: test

GEN_MAPPINGS_FILES[] = 
   config
   gen_unimap 
   gen_mappings

GEN_MAPPINGS = gen_mappings

OCAML_LIBS += conversion
OCAML_OTHER_LIBS += fstream
USE_OCAMLFIND = true
OCAMLPACKS[] = pcre

#.DEFAULT: $(OCamlProgram $(GEN_MAPPINGS), $(GEN_MAPPINGS_FILES))

IFILES[] =
   cs

LibInstall(makelib, $(LIB), $(IFILES))

mappings: $(GEN_MAPPINGS)
   ./$(GEN_MAPPINGS) ./data/tables

clean:
   $(CLEAN) $(GEN_MAPPINGS) config.ml

